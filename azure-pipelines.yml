# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master

pool:
  vmImage: ubuntu-latest

steps:
- script: |
     curl --compressed https://downloads.snyk.io/cli/stable/snyk-linux -o snyk
     chmod +x ./snyk
     mv ./snyk /usr/local/bin/
     npm install -g snyk-to-html 
     chmod +x ./mvnw
     mkdir -p result
     snyk auth $(SYNK_TOKEN)
     snyk test --all-projects --json-file-output=result/oss.json
     snyk code test --sarif-file-output=result/sast.sarif
     snyk-to-html -o result/oss.html < result/oss.json
     snyk-to-html -o result/sast.html < result/sast.sarif
  env:
    SYNK_TOKEN: $(SYNK_TOKEN)
  continueOnError: True
  displayName: 'Security Scan'
- publish: $(System.DefaultWorkingDirectory)/result
  artifact: MyArtifact 

